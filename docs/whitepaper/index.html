<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XNPBK7CRGG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XNPBK7CRGG');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QIF Whitepaper | Quantum Indeterministic Framework for Neural Security</title>
    <meta name="description" content="The QIF Whitepaper: A quantum-informed framework for brain-computer interface security. Coherence metrics, scale-frequency invariance, and the hourglass architecture.">
    <meta name="keywords" content="QIF whitepaper, neurosecurity, neural interface, brain-computer interface, quantum indeterministic framework, coherence metric, neural firewall, BCI security">

    <!-- Open Graph -->
    <meta property="og:title" content="QIF Whitepaper | Quantum Indeterministic Framework for Neural Security">
    <meta property="og:description" content="A quantum-informed framework for securing brain-computer interfaces — the complete QIF overview.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://qinnovate.com/mindloft/whitepaper/">
    <meta property="og:image" content="https://qinnovate.com/mindloft/images/ONI_Banner_Logo.png">

    <!-- GSAP + ScrollTrigger (same versions as landing page) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: rgba(17, 24, 39, 0.85);
            --bg-card: rgba(26, 35, 50, 0.9);
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --accent-pink: #ec4899;
            --accent-amber: #f59e0b;
            --accent-emerald: #10b981;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html {
            scroll-behavior: smooth;
            background: var(--bg-primary);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
        }

        /* Navigation */
        .wp-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: rgba(10, 15, 26, 0.92);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .wp-nav a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: color 0.2s;
        }
        .wp-nav a:hover { color: var(--accent-cyan); }

        .wp-nav .nav-brand {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.05em;
        }
        .wp-nav .nav-brand span { color: var(--accent-cyan); }

        .nav-links { display: flex; gap: 1.5rem; align-items: center; }

        .nav-links .btn-sm {
            background: var(--accent-blue);
            color: #fff;
            padding: 0.35rem 0.9rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: background 0.2s;
        }
        .nav-links .btn-sm:hover { background: #2563eb; }

        /* Floating TOC */
        .toc {
            position: fixed;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 260px;
            background: rgba(10, 15, 26, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 1.5rem 1rem;
            z-index: 50;
            transition: transform 0.3s;
        }

        .toc h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .toc a {
            display: block;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.82rem;
            padding: 0.35rem 0.5rem;
            border-radius: 4px;
            line-height: 1.4;
            transition: all 0.2s;
        }
        .toc a:hover { color: var(--accent-cyan); background: rgba(6, 182, 212, 0.08); }
        .toc a.active { color: var(--accent-cyan); background: rgba(6, 182, 212, 0.12); border-left: 2px solid var(--accent-cyan); }

        /* Main content */
        .wp-content {
            max-width: 820px;
            margin: 0 auto;
            padding: 5rem 2rem 4rem;
            margin-left: 260px;
        }

        /* Hero */
        .wp-hero {
            text-align: center;
            padding: 3rem 0 2rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 3rem;
        }

        .wp-hero .badge {
            display: inline-block;
            background: rgba(6, 182, 212, 0.12);
            color: var(--accent-cyan);
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
        }

        .wp-hero h1 {
            font-size: 2.8rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        .wp-hero h1 span { color: var(--accent-cyan); }

        .wp-hero .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 1.5rem;
        }

        .wp-hero .meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .wp-hero .meta strong { color: var(--text-secondary); }

        /* Epigraph */
        .epigraph {
            text-align: center;
            padding: 2rem 0;
            margin: 2rem 0;
        }
        .epigraph blockquote {
            font-style: italic;
            font-size: 1.15rem;
            color: var(--text-secondary);
            border: none;
            padding: 0;
            background: none;
        }

        /* Sections */
        .wp-section {
            margin-bottom: 3rem;
            scroll-margin-top: 80px;
        }

        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
            letter-spacing: -0.01em;
        }
        h2 .sec-num { color: var(--accent-cyan); font-weight: 400; margin-right: 0.3rem; }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 1.5rem 0 0.75rem;
        }

        p { margin-bottom: 1rem; color: var(--text-secondary); }
        p strong { color: var(--text-primary); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.2rem 0;
            font-size: 0.9rem;
        }
        th {
            text-align: left;
            padding: 0.6rem 0.8rem;
            background: rgba(30, 41, 59, 0.6);
            color: var(--text-primary);
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            font-size: 0.82rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        td {
            padding: 0.55rem 0.8rem;
            border-bottom: 1px solid rgba(30, 41, 59, 0.4);
            color: var(--text-secondary);
        }
        tr:hover td { background: rgba(30, 41, 59, 0.3); }

        /* Code blocks */
        pre {
            background: rgba(15, 20, 35, 0.9);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem 1.2rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        code {
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.88em;
            background: rgba(30, 41, 59, 0.5);
            padding: 0.15em 0.4em;
            border-radius: 4px;
            color: var(--accent-cyan);
        }
        pre code { background: none; padding: 0; color: inherit; }

        /* Figures */
        .figure {
            margin: 2rem 0;
            text-align: center;
        }
        .figure img {
            max-width: 100%;
            border-radius: 10px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        .figure figcaption {
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
            line-height: 1.5;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Blockquotes / callouts */
        blockquote {
            border-left: 3px solid var(--accent-cyan);
            background: rgba(6, 182, 212, 0.06);
            padding: 1rem 1.2rem;
            margin: 1.2rem 0;
            border-radius: 0 8px 8px 0;
        }
        blockquote p { color: var(--text-secondary); margin-bottom: 0; }
        blockquote strong { color: var(--accent-cyan); }
        blockquote a { color: var(--accent-cyan); }

        /* Lists */
        ul, ol {
            margin: 0.5rem 0 1rem 1.5rem;
            color: var(--text-secondary);
        }
        li { margin-bottom: 0.3rem; }

        /* Highlight box */
        .highlight-box {
            background: rgba(245, 158, 11, 0.08);
            border: 1px solid rgba(245, 158, 11, 0.25);
            border-radius: 10px;
            padding: 1.2rem 1.5rem;
            margin: 1.5rem 0;
        }
        .highlight-box p { color: var(--text-primary); }

        /* References */
        .references { font-size: 0.85rem; }
        .references p { margin-bottom: 0.6rem; line-height: 1.5; }

        /* Footer */
        .wp-footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Back to top */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 42px;
            height: 42px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: transform 0.2s;
        }
        .back-to-top:hover { transform: scale(1.1); }
        .back-to-top.visible { display: flex; }

        /* Responsive */
        @media (max-width: 1024px) {
            .toc { display: none; }
            .wp-content { margin-left: 0; max-width: 720px; }
        }

        @media (max-width: 640px) {
            .wp-content { padding: 4rem 1rem 3rem; }
            .wp-hero h1 { font-size: 2rem; }
            .wp-hero .subtitle { font-size: 1.1rem; }
            h2 { font-size: 1.4rem; }
            table { font-size: 0.8rem; }
            th, td { padding: 0.4rem 0.5rem; }
        }

        /* Links */
        a { color: var(--accent-cyan); text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* HR */
        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2.5rem 0;
        }

        /* ============================================
           3D CURVED DISPLAY EFFECT
           ============================================ */
        .wp-perspective {
            perspective: 1200px;
            perspective-origin: 50% 50%;
        }

        .wp-section {
            transform-style: preserve-3d;
            will-change: transform, opacity;
            backface-visibility: hidden;
        }

        /* Vignette overlay — simulates curved monitor edges */
        .wp-vignette {
            position: fixed;
            top: 0;
            left: 260px;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
            background: radial-gradient(
                ellipse 80% 70% at 50% 50%,
                transparent 55%,
                rgba(10, 15, 26, 0.35) 100%
            );
            transition: opacity 0.4s;
        }

        /* Reduced motion: kill all 3D */
        @media (prefers-reduced-motion: reduce) {
            .wp-section {
                transform: none !important;
                opacity: 1 !important;
            }
            .wp-vignette { display: none; }
        }
        body.reduced-motion .wp-section {
            transform: none !important;
            opacity: 1 !important;
        }
        body.reduced-motion .wp-vignette { display: none; }

        /* Mobile: no 3D effects */
        @media (max-width: 1024px) {
            .wp-vignette { display: none; }
            .wp-section {
                transform: none !important;
                opacity: 1 !important;
            }
        }

        /* ============================================
           VOICEOVER TOGGLE
           ============================================ */
        #wp-voiceover-toggle {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            z-index: 200;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid rgba(6, 182, 212, 0.35);
            background: rgba(10, 15, 26, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.4);
            transition: border-color 0.3s, box-shadow 0.3s;
            padding: 0;
            outline: none;
        }
        #wp-voiceover-toggle:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 16px rgba(6, 182, 212, 0.25);
        }
        #wp-voiceover-toggle:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 2px;
        }
        #wp-voiceover-toggle svg {
            width: 22px;
            height: 22px;
            fill: none;
            stroke: var(--accent-cyan);
            stroke-width: 1.8;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        #wp-voiceover-toggle[data-state="off"] svg {
            stroke: var(--text-muted);
        }
        #wp-voiceover-toggle[data-state="off"] {
            border-color: rgba(71, 85, 105, 0.35);
        }
        /* Tooltip */
        #wp-voiceover-toggle::after {
            content: attr(aria-label);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 0;
            background: rgba(10, 15, 26, 0.95);
            color: var(--text-secondary);
            font-size: 0.7rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 4px 10px;
            border-radius: 6px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transform: translateY(4px);
            transition: opacity 0.2s, transform 0.2s;
            border: 1px solid var(--border);
        }
        #wp-voiceover-toggle:hover::after {
            opacity: 1;
            transform: translateY(0);
        }

        /* Voiceover status bar */
        #wp-voiceover-bar {
            position: fixed;
            bottom: 5rem;
            left: 2rem;
            z-index: 200;
            background: rgba(10, 15, 26, 0.92);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(6, 182, 212, 0.25);
            border-radius: 8px;
            padding: 0.4rem 0.9rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            opacity: 0;
            visibility: hidden;
            transform: translateY(8px);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            max-width: 280px;
        }
        #wp-voiceover-bar.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        #wp-voiceover-bar .bar-label {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        /* ============================================
           BCI MODE OVERRIDES
           ============================================ */
        body.bci-mode .wp-content {
            font-size: 1.15rem;
            line-height: 2.0;
            max-width: 700px;
        }
        body.bci-mode h2 { font-size: 2.2rem; }
        body.bci-mode p { color: var(--text-primary); }
        body.bci-mode .wp-section {
            margin-bottom: 4rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            /* Disable 3D in BCI mode (vestibular safety) */
            transform: none !important;
            opacity: 1 !important;
        }
        body.bci-mode table { font-size: 1rem; }
        body.bci-mode td, body.bci-mode th { padding: 0.8rem 1rem; }
        body.bci-mode .wp-vignette { display: none; }
        body.bci-mode #wp-voiceover-toggle {
            width: 52px;
            height: 52px;
            border: 2px solid var(--accent-cyan);
        }
        body.bci-mode #wp-voiceover-toggle svg {
            width: 26px;
            height: 26px;
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="wp-nav">
    <a href="../" class="nav-brand"><span>ONI</span> Framework</a>
    <div class="nav-links">
        <a href="../">Home</a>
        <a href="../research/">Research</a>
        <a href="../visualizations/">Visualizations</a>
        <a href="../documentation/">Docs</a>
        <a href="../about/">About</a>
        <a href="../blog/">Blog</a>
        <a href="https://github.com/qinnovates/mindloft" class="btn-sm">GitHub</a>
    </div>
</nav>

<!-- Floating Table of Contents -->
<aside class="toc" id="toc">
    <h3>Table of Contents</h3>
    <a href="#intro">1. Introduction</a>
    <a href="#problem">2. The Problem</a>
    <a href="#hourglass">3. The Hourglass Architecture</a>
    <a href="#coherence-metric">4. The Coherence Metric</a>
    <a href="#scale-frequency">5. Scale-Frequency Invariance</a>
    <a href="#qi-equation">6. The Quantum Integer</a>
    <a href="#decoherence">7. Decoherence & Threat Modeling</a>
    <a href="#neural-firewall">8. The Neural Firewall</a>
    <a href="#falsifiability">9. Falsifiability & Testable Predictions</a>
    <a href="#related-work">10. Related Work</a>
    <a href="#conclusion">11. Conclusion</a>
    <a href="#references">12. References</a>
</aside>

<!-- Main Content -->
<main class="wp-content">

    <!-- Hero -->
    <header class="wp-hero">
        <div class="badge">QIF Whitepaper — Draft</div>
        <h1><span>QIF</span> Whitepaper</h1>
        <p class="subtitle">Quantum Indeterministic Framework for Neural Security</p>
        <p class="meta"><strong>Kevin L. Qi</strong> &middot; 2026</p>
    </header>

    <div class="epigraph">
        <blockquote>"Only life's most important connections deserve the most thought."</blockquote>
    </div>

    <!-- =============================================
         QIF WHITEPAPER CONTENT
         Content will be populated from QIF-WHITEPAPER.md
         when the whitepaper draft is finalized.
         The ONI version is preserved at docs/legacy/whitepaper-oni/
         ============================================= -->

    <section class="wp-section" id="intro">
        <h2><span class="sec-num">1.</span> Introduction</h2>
        <p>Content pending — will be populated from the QIF whitepaper draft.</p>
        <div class="highlight-box">
            <p><strong>This interactive whitepaper is under construction.</strong> The immersive reading experience (3D scroll, AI voiceover) is live. QIF content is being finalized in the working draft.</p>
        </div>
        <p>For the legacy ONI Framework whitepaper, see the <a href="../legacy/whitepaper-oni/">archived version</a>.</p>
    </section>

    <section class="wp-section" id="problem">
        <h2><span class="sec-num">2.</span> The Problem</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="hourglass">
        <h2><span class="sec-num">3.</span> The Hourglass Architecture</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="coherence-metric">
        <h2><span class="sec-num">4.</span> The Coherence Metric</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="scale-frequency">
        <h2><span class="sec-num">5.</span> Scale-Frequency Invariance</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="qi-equation">
        <h2><span class="sec-num">6.</span> The Quantum Integer</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="decoherence">
        <h2><span class="sec-num">7.</span> Decoherence &amp; Threat Modeling</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="neural-firewall">
        <h2><span class="sec-num">8.</span> The Neural Firewall</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="falsifiability">
        <h2><span class="sec-num">9.</span> Falsifiability &amp; Testable Predictions</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="related-work">
        <h2><span class="sec-num">10.</span> Related Work</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="conclusion">
        <h2><span class="sec-num">11.</span> Conclusion</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section" id="references">
        <h2><span class="sec-num">12.</span> References</h2>
        <p>Content pending.</p>
    </section>

    <section class="wp-section">
        <h3>About the Author</h3>
        <p><strong>Kevin L. Qi</strong> is an independent researcher focused on neurosecurity — the intersection of brain-computer interface technology and cybersecurity. He created the QIF to provide a quantum-informed framework for securing the bio-digital boundary.</p>
        <p><a href="https://github.com/qinnovates/mindloft">GitHub</a> &middot; <a href="https://qinnovate.com/mindloft/">Mindloft</a></p>
    </section>

    <section class="wp-section">
        <h3>Acknowledgments</h3>
        <p>The author wishes to acknowledge the support of colleagues and mentors in the development of this work. Initial research validation was conducted through LMArena (LMSYS, 2024-2025), enabling cross-model verification of hypotheses and findings. Deep research synthesis and writing assistance was provided by Claude (Anthropic, 2025). All original ideas, theoretical frameworks, analyses, and conclusions are the author's own.</p>
    </section>

    <!-- Footer -->
    <footer class="wp-footer">
        <p>&copy; 2026 Kevin Qi. QIF — Quantum Indeterministic Framework for Neural Security &middot; Open source under Apache 2.0 License</p>
        <p style="margin-top: 0.5rem; font-style: italic; color: var(--text-muted);">"Only life's most important connections deserve the most thought."</p>
        <p style="margin-top: 1rem;"><a href="../">Back to Home</a> &middot; <a href="https://github.com/qinnovates/mindloft">View on GitHub</a> &middot; <a href="../legacy/whitepaper-oni/">Legacy ONI Whitepaper</a></p>
    </footer>

</main>

<!-- Vignette overlay for curved display effect -->
<div class="wp-vignette" id="wp-vignette"></div>

<!-- Voiceover toggle -->
<button id="wp-voiceover-toggle" type="button" data-state="off" aria-label="Enable AI voiceover" title="Toggle AI voiceover">
    <!-- Speaker icon (OFF state) -->
    <svg id="wp-vo-icon-off" viewBox="0 0 24 24" aria-hidden="true">
        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
        <line x1="23" y1="9" x2="17" y2="15"/>
        <line x1="17" y1="9" x2="23" y2="15"/>
    </svg>
    <!-- Speaker icon (ON state) -->
    <svg id="wp-vo-icon-on" viewBox="0 0 24 24" style="display:none;" aria-hidden="true">
        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
    </svg>
</button>

<!-- Voiceover status bar -->
<div id="wp-voiceover-bar">
    <span class="bar-label">Now playing:</span> <span id="wp-voiceover-title">—</span>
</div>

<!-- Hidden audio element -->
<audio id="wp-narrator" preload="none"></audio>

<!-- Back to Top -->
<button class="back-to-top" id="backToTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>

<script>
(function() {
    'use strict';

    // =============================================
    // MODE DETECTION
    // =============================================
    var prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    var storedAnimPref = localStorage.getItem('oni-animations-enabled');
    var manualReduced = storedAnimPref === 'false';
    var bciEnabled = localStorage.getItem('oni-bci-mode-enabled') === 'true';

    if (manualReduced || prefersReduced) {
        document.body.classList.add('reduced-motion');
    }
    if (bciEnabled) {
        document.body.classList.add('bci-mode');
    }

    var animationsEnabled = !prefersReduced && !manualReduced && !bciEnabled;
    var isMobile = window.innerWidth <= 1024;

    // =============================================
    // BACK TO TOP
    // =============================================
    window.addEventListener('scroll', function() {
        var btn = document.getElementById('backToTop');
        btn.classList.toggle('visible', window.scrollY > 400);
    });

    // =============================================
    // TOC HIGHLIGHTING
    // =============================================
    var sections = document.querySelectorAll('.wp-section');
    var tocLinks = document.querySelectorAll('.toc a');

    var tocObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                tocLinks.forEach(function(link) { link.classList.remove('active'); });
                var id = entry.target.id;
                var activeLink = document.querySelector('.toc a[href="#' + id + '"]');
                if (activeLink) activeLink.classList.add('active');
            }
        });
    }, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });

    sections.forEach(function(section) {
        if (section.id) tocObserver.observe(section);
    });

    // =============================================
    // 3D CURVED DISPLAY EFFECT
    // =============================================
    var vignette = document.getElementById('wp-vignette');

    if (animationsEnabled && !isMobile) {
        gsap.registerPlugin(ScrollTrigger);

        // Wrap .wp-content in perspective container
        var wpContent = document.querySelector('.wp-content');
        var perspectiveWrap = document.createElement('div');
        perspectiveWrap.classList.add('wp-perspective');
        wpContent.parentNode.insertBefore(perspectiveWrap, wpContent);
        perspectiveWrap.appendChild(wpContent);

        // Per-section 3D curve driven by scroll
        sections.forEach(function(section) {
            ScrollTrigger.create({
                trigger: section,
                start: 'top 85%',
                end: 'bottom 15%',
                scrub: 0.5,
                onUpdate: function(self) {
                    var p = self.progress; // 0 (entered bottom) → 1 (exiting top)
                    var rotateX = 3 - (p * 6); // +3 → 0 → -3
                    var translateZ = -Math.abs(p - 0.5) * 30; // -15 at edges, 0 at center
                    var opacity = 1 - Math.abs(p - 0.5) * 0.25;

                    gsap.set(section, {
                        rotateX: rotateX,
                        z: translateZ,
                        opacity: opacity,
                        transformPerspective: 1200
                    });
                }
            });
        });
    } else {
        // No 3D — hide vignette
        if (vignette) vignette.style.display = 'none';
    }

    // Listen for OS reduced-motion changes at runtime
    if (window.matchMedia) {
        window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', function(e) {
            if (e.matches) {
                document.body.classList.add('reduced-motion');
                if (vignette) vignette.style.display = 'none';
                if (typeof ScrollTrigger !== 'undefined') {
                    ScrollTrigger.getAll().forEach(function(st) { st.kill(); });
                }
                sections.forEach(function(s) {
                    s.style.transform = '';
                    s.style.opacity = '';
                });
            }
        });
    }

    // =============================================
    // VOICEOVER NARRATOR
    // =============================================
    var AUDIO_MANIFEST = {
        'intro':            { src: 'audio/01-introduction.mp3',       title: 'Introduction' },
        'problem':          { src: 'audio/02-problem.mp3',            title: 'The Problem' },
        'hourglass':        { src: 'audio/03-hourglass.mp3',          title: 'The Hourglass Architecture' },
        'coherence-metric': { src: 'audio/04-coherence-metric.mp3',   title: 'The Coherence Metric' },
        'scale-frequency':  { src: 'audio/05-scale-frequency.mp3',    title: 'Scale-Frequency Invariance' },
        'qi-equation':      { src: 'audio/06-qi-equation.mp3',        title: 'The Quantum Integer' },
        'decoherence':      { src: 'audio/07-decoherence.mp3',        title: 'Decoherence & Threat Modeling' },
        'neural-firewall':  { src: 'audio/08-neural-firewall.mp3',    title: 'The Neural Firewall' },
        'falsifiability':   { src: 'audio/09-falsifiability.mp3',     title: 'Falsifiability & Testable Predictions' },
        'related-work':     { src: 'audio/10-related-work.mp3',       title: 'Related Work' },
        'conclusion':       { src: 'audio/11-conclusion.mp3',         title: 'Conclusion' },
        'references':       { src: 'audio/12-references.mp3',         title: 'References' }
    };

    var voToggleBtn = document.getElementById('wp-voiceover-toggle');
    var voIconOn = document.getElementById('wp-vo-icon-on');
    var voIconOff = document.getElementById('wp-vo-icon-off');
    var voBar = document.getElementById('wp-voiceover-bar');
    var voTitle = document.getElementById('wp-voiceover-title');
    var audioEl = document.getElementById('wp-narrator');
    var voEnabled = false;
    var currentSectionId = null;

    function updateVoToggleUI(enabled) {
        voToggleBtn.setAttribute('data-state', enabled ? 'on' : 'off');
        voToggleBtn.setAttribute('aria-label', enabled ? 'Disable AI voiceover' : 'Enable AI voiceover');
        voIconOn.style.display = enabled ? '' : 'none';
        voIconOff.style.display = enabled ? 'none' : '';
    }

    function showVoBar(text) {
        voTitle.textContent = text;
        voBar.classList.add('visible');
    }

    function hideVoBar() {
        voBar.classList.remove('visible');
    }

    function playSection(sectionId) {
        if (!voEnabled || !sectionId) return;
        if (sectionId === currentSectionId && !audioEl.paused) return;

        var entry = AUDIO_MANIFEST[sectionId];
        if (!entry) {
            showVoBar('Section audio not mapped');
            return;
        }

        currentSectionId = sectionId;
        showVoBar(entry.title);

        // Fade out current audio
        if (!audioEl.paused) {
            var fadeOut = setInterval(function() {
                if (audioEl.volume > 0.1) {
                    audioEl.volume -= 0.1;
                } else {
                    clearInterval(fadeOut);
                    audioEl.pause();
                    audioEl.volume = 1;
                    loadAndPlay(entry);
                }
            }, 25);
        } else {
            loadAndPlay(entry);
        }
    }

    function loadAndPlay(entry) {
        audioEl.src = entry.src;
        audioEl.volume = 1;
        var playPromise = audioEl.play();
        if (playPromise !== undefined) {
            playPromise.catch(function() {
                // Audio file not found or autoplay blocked
                showVoBar(entry.title + ' — audio coming soon');
            });
        }
    }

    audioEl.addEventListener('error', function() {
        if (voEnabled && currentSectionId) {
            var entry = AUDIO_MANIFEST[currentSectionId];
            var title = entry ? entry.title : currentSectionId;
            showVoBar(title + ' — audio coming soon');
        }
    });

    audioEl.addEventListener('ended', function() {
        showVoBar('Section complete');
        setTimeout(hideVoBar, 2000);
    });

    voToggleBtn.addEventListener('click', function() {
        voEnabled = !voEnabled;
        updateVoToggleUI(voEnabled);

        if (voEnabled) {
            // Try to play the current visible section
            if (currentSectionId) {
                playSection(currentSectionId);
            } else {
                showVoBar('Scroll to begin narration');
                setTimeout(hideVoBar, 3000);
            }
        } else {
            audioEl.pause();
            audioEl.currentTime = 0;
            currentSectionId = null;
            hideVoBar();
        }
    });

    // Section-enter triggers for voiceover (uses IntersectionObserver, works regardless of 3D mode)
    var voObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting && entry.target.id) {
                if (voEnabled) {
                    playSection(entry.target.id);
                } else {
                    // Track current section even when voiceover is off
                    currentSectionId = entry.target.id;
                }
            }
        });
    }, { rootMargin: '-40% 0px -40% 0px', threshold: 0 });

    sections.forEach(function(section) {
        if (section.id && AUDIO_MANIFEST[section.id]) {
            voObserver.observe(section);
        }
    });

})();
</script>

<!-- QIF Whitepaper — content source: qinnovates/mindloft/drafts/ai-working/QIF-WHITEPAPER.md -->
<!-- Legacy ONI whitepaper preserved at: docs/legacy/whitepaper-oni/ -->
</body>
</html>
